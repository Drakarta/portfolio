---
import Layout from "../layouts/Layout.astro";
import HomeSection from "../components/sections/HomeSection.tsx";
import HomeSectionMobile from "../components/sections/HomeSectionMobile.tsx";
import ScrollIndicator from "../components/ScrollIndicator.tsx";
import SecondSection from "../components/sections/SecondSection.tsx";
---

<Layout title="Anthony">
	<style>
		.buffer-top {
			top: calc(-50vh + 102px);
			@media (max-width: 768px) {
				top: calc(-50vh + 74px);
			}
		}
		.buffer-bottom {
			top: calc(50vh - 102px);
			@media (max-width: 768px) {
				top: calc(50vh - 74px);
			}
		}
	</style>
	<script>
		type ArrowKey = "ArrowUp" | "ArrowDown" | "ArrowLeft" | "ArrowRight";

		const code: ArrowKey[] = [
			"ArrowUp",
			"ArrowUp",
			"ArrowDown",
			"ArrowDown",
			"ArrowLeft",
			"ArrowRight",
			"ArrowLeft",
			"ArrowRight",
		];
		let pressed: ArrowKey[] = [];

		const handleKeyPress = (event: { key: string }) => {
			if (code.includes(event.key as ArrowKey)) {
				if (code[pressed.length] === event.key) {
					pressed.push(event.key);
					console.log(pressed);
				} else {
					pressed = [];
				}
				if (pressed.length === code.length) {
					window.location.href = "https://www.youtube.com/watch?v=dQw4w9WgXcQ";
				}
			} else {
				pressed = [];
			}
		};

		let StartX: number = 0;
		let StartY: number = 0;
		const handleSwipeStart = (event: TouchEvent) => {
			StartX = event.changedTouches[0].screenX;
			StartY = event.changedTouches[0].screenY;
		};
		const handleSwipeEnd = (event: TouchEvent) => {
			const diffY: number = event.changedTouches[0].screenY - StartY;
			const diffX: number = event.changedTouches[0].screenX - StartX;
			if (Math.abs(diffX) > Math.abs(diffY)) {
				if (diffX > 0) {
					handleKeyPress({ key: "ArrowRight" } as KeyboardEvent);
				}
				if (diffX < 0) {
					handleKeyPress({ key: "ArrowLeft" } as KeyboardEvent);
				}
			} else {
				if (diffY > 0) {
					handleKeyPress({ key: "ArrowDown" } as KeyboardEvent);
				}
				if (diffY < 0) {
					handleKeyPress({ key: "ArrowUp" } as KeyboardEvent);
				}
				if (diffY === 0) {
					handleKeyPress({ key: "ArrowUp" } as KeyboardEvent);
				}
			}
		};

		const handleScroll = () => {
			const element = document.getElementById("home");
			if (!element) return;

			if (window.innerWidth > 768) {
				if (window.scrollY > window.innerHeight) {
					element.classList.remove("fixed", "buffer-top");
					element.classList.add("absolute");
				} else if (window.scrollY > window.innerHeight - 204) {
					element.classList.add("fixed", "buffer-top");
					element.classList.remove("absolute", "buffer-bottom");
				} else if (window.scrollY > window.innerHeight * 0.5 - 102) {
					console.log(`270 = ${270 / window.innerHeight}`);
					element.classList.remove("fixed", "buffer-top");
					element.classList.add("absolute", "buffer-bottom");
				} else if (window.scrollY > 0) {
					element.classList.add("fixed");
					element.classList.remove("absolute", "buffer-bottom");
				}
			} else if (window.innerWidth < 768) {
				if (window.scrollY > window.innerHeight) {
					element.classList.remove("fixed", "buffer-top");
					element.classList.add("absolute");
				} else if (window.scrollY > window.innerHeight - 148) {
					element.classList.add("fixed", "buffer-top");
					element.classList.remove("absolute", "buffer-bottom");
				} else if (window.scrollY > window.innerHeight * 0.5 - 74) {
					element.classList.remove("fixed", "buffer-top");
					element.classList.add("absolute", "buffer-bottom");
				} else if (window.scrollY > 0) {
					element.classList.add("fixed");
					element.classList.remove("absolute", "buffer-bottom");
				}
			}
		};

		window.addEventListener("scroll", handleScroll);
		window.addEventListener("keydown", handleKeyPress);
		window.addEventListener("touchstart", handleSwipeStart);
		window.addEventListener("touchend", handleSwipeEnd);
	</script>
	<section id="home" class="fixed w-full">
		<div class="hidden md:block">
			<HomeSection client:load />
		</div>
		<div class="block md:hidden">
			<HomeSectionMobile client:load />
		</div>
	</section>
	<!-- Buffer so the scrolling works as intended -->
	<div class="h-screen"></div>
	<ScrollIndicator client:idle />
	<section id="second" class="relative h-screen bg-slate-600">
		<SecondSection client:idle />
	</section>
	<section class="h-screen"></section>
</Layout>
